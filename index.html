<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>My Website with AI Chatbot</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 40px; }
  </style>

  <!-- Chat UI Libraries (loaded from CDN) -->
  <script src="https://cdn.jsdelivr.net/npm/react@18/umd/react.production.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/ai@latest/dist/react.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@chatscope/chat-ui-kit-styles@1/dist/styles.min.css"/>
  <script type="module" src="https://cdn.jsdelivr.net/npm/@chatscope/chat-ui-kit-react@1/dist/index.js"></script>
</head>
<body>

  <h1>Welcome to My Simple Website</h1>
  <p>This is a normal static site — but now it has a smart AI chatbot in the corner!</p>

  <div id="chatbot"></div>

  <!-- THE MAGIC: Chatbot + Backend API in one file! -->
  <script type="module">
    import React from "https://cdn.jsdelivr.net/npm/react@18/index.js";
    import ReactDOM from "https://cdn.jsdelivr.net/npm/react-dom@18/index.js";
    import { useChat } from "ai/react";
    import { MainContainer, ChatContainer, MessageList, Message, MessageInput, TypingIndicator } from "https://cdn.jsdelivr.net/npm/@chatscope/chat-ui-kit-react@1/dist/index.js";

    // === THIS IS YOUR BACKEND API (runs on Vercel Edge) ===
    async function apiHandler(messages) {
      const response = await fetch("https://api.openai.com/v1/chat/completions", {  // or use Groq below
      // const response = await fetch("https://api.groq.com/openai/v1/chat/completions", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          // PUT YOUR KEY HERE ↓↓↓ (it will be hidden in browser)
          "Authorization": "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"   // ← CHANGE THIS
          // "Authorization": "Bearer gsk_your-groq-key-here" // ← or use Groq (faster)
        },
        body: JSON.stringify({
          model: "gpt-4o-mini",                 // OpenAI
          // model: "llama-3.3-70b-specdec",    // Groq (uncomment if using Groq)
          messages: messages.map(m => ({ role: m.role, content: m.content })),
          stream: true
        })
      });

      return response.body;
    }

    // === The Chatbot UI ===
    const ChatBot = () => {
      const { messages, input, handleInputChange, handleSubmit, setInput, isLoading } = useChat({
        api: "/", // dummy – we override it
        sendMessage: async (message) => {
          const newMessages = [...messages, { id: Date.now(), role: "user", content: message }];
          setInput("");
          const stream = await apiHandler(newMessages);
          return stream;
        }
      });

      return (
        <div style={{position:"fixed",bottom:"20px",right:"20px",width:"380px",height:"620px",borderRadius:"16px",boxShadow:"0 10px 40px rgba(0,0,0,0.3)",zIndex:999999,overflow:"hidden"}}>
          <MainContainer>
            <ChatContainer>
              <MessageList>
                {messages.map((m, i) => (
                  <Message key={i} model={{
                    message: m.content,
                    direction: m.role === "user" ? "outgoing" : "incoming",
                    position: "single"
                  }} />
                ))}
                {isLoading && <TypingIndicator content="Thinking..." />}
              </MessageList>
              <MessageInput 
                placeholder="Ask me anything..." 
                onSend={(_, text) => handleSubmit(new CustomEvent('', {detail: text}))}
                value={input}
                onChange={handleInputChange}
              />
            </ChatContainer>
          </MainContainer>
        </div>
      );
    };

    ReactDOM.createRoot(document.getElementById('chatbot')).render(<ChatBot />);
  </script>
</body>
</html>
